{"head":{"title":"Phoenix: Ecto migrations","category":"Elixir","layout":"2017/sheet","weight":-1,"updated":"2020-02-23T00:00:00.000Z"},"body":[{"title":"Creating","elms":"\n```bash\n$ mix ecto.gen.migration update_posts_table\n  creating priv/repo/migrations/20160602085927_update_posts_table.exs\n  ···\n```\n\n```bash\n$ mix ecto.migrate\n$ mix ecto.rollback\n```\n\nCreates a migration (no models).\n","h2":null},{"title":"Creating models","elms":"\n```bash\n$ mix phoenix.gen.model Message messages user_id:integer content:text\n```\n\nThis is only for Phoenix 1.2 or older; models aren't available in Phoenix 1.3+.\n","h2":null},{"title":"Creating context","elms":"\n```bash\n$ mix phx.gen.context Images Album albums title:string subtitle:string privacy:string\n```\n ","h2":null},{"title":"Creating tables","elms":"\n```elixir\ncreate table(:documents) do\n  add :title, :string\n  add :title, :string, size: 40\n  add :title, :string, default: \"Hello\"\n  add :title, :string, default: fragment(\"now()\")\n  add :title, :string, null: false\n  add :body, :text\n  add :age, :integer\n  add :price, :float\n  add :price, :float\n  add :price, :decimal, precision: 10, scale: 2\n  add :published_at, :utc_datetime\n  add :group_id, references(:groups)\n  add :object, :json\n\n  timestamps  # inserted_at and updated_at\nend\n\ncreate_if_not_exists table(:documents) do: ... end\n```\n","h2":"Migration functions"},{"title":"Other operations","elms":"\n```elixir\nalter table(:posts) do\n  add :summary, :text\n  modify :title, :text\n  remove :views\nend\n```\n\n```elixir\nrename table(:posts), :title, to: :summary\nrename table(:posts), to: table(:new_posts)\n```\n\n```elixir\ndrop table(:documents)\ndrop_if_exists table(:documents)\n```\n\n```elixir\ntable(:documents)\ntable(:weather, prefix: :north_america)\n```\n","h2":"Migration functions"},{"title":"Indices","elms":"\n```elixir\ncreate index(:posts, [:slug], concurrently: true)\ncreate unique_index(:posts, [:slug])\ndrop index(:posts, [:name])\n```\n","h2":"Migration functions"},{"title":"Execute SQL","elms":"\n```elixir\nexecute \"UPDATE posts SET published_at = NULL\"\nexecute create: \"posts\", capped: true, size: 1024\n```\n","h2":"Migration functions"},{"title":null,"elms":"\n- [Ecto.Migration](http://devdocs.io/phoenix/ecto/ecto.migration)","h2":"References"}]}